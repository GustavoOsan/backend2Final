<div style="margin: 50px;">
    <h2>Crear Nueva Contraseña</h2>
    <form id="resetForm">
        <label>Nueva Contraseña:</label>
        <input name="newPassword" type="password" required>
        <button type="submit">Cambiar Contraseña</button>
    </form>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    const form = document.getElementById('resetForm');
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');

    form.addEventListener('submit', e => {
        e.preventDefault();
        const data = new FormData(form);
        const obj = {};
        data.forEach((value, key) => obj[key] = value);
        obj.token = token; 

        fetch('/api/sessions/reset-password', {
            method: 'POST',
            body: JSON.stringify(obj),
            headers: { 'Content-Type': 'application/json' }
        }).then(result => result.json()).then(json => {
            if (json.status === 'success') {
                Swal.fire('¡Listo!', 'Contraseña cambiada', 'success').then(() => {
                    window.location.replace('/login');
                });
            } else {
                Swal.fire('Error', json.message, 'error');
            }
        });
    })
</script>